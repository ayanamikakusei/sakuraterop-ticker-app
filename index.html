<!DOCTYPE html>
<html lang="ja">
<head>
    <link rel="manifest" href="./manifest.json">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSSãƒ†ãƒ­ãƒƒãƒ—è¡¨ç¤ºãƒ„ãƒ¼ãƒ«</title>
    <!-- PWA (Progressive Web App) å¯¾å¿œã®ãŸã‚ã®è¨­å®š -->
    <meta name="theme-color" content="#007bff"/>
    <link rel="manifest" href="./manifest.json">
    <!-- ãƒ–ãƒ©ã‚¦ã‚¶ã‚¿ãƒ–ç”¨ã®å‹•çš„ã‚¢ã‚¤ã‚³ãƒ³ -->
    <link id="favicon" rel="icon" type="image/svg+xml" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="20" y="10" width="25" height="80" fill="gray"/><rect x="55" y="10" width="25" height="80" fill="gray"/></svg>'>
    <style>
        body {
            margin: 0;
            overflow: hidden; /* ãƒ†ãƒ­ãƒƒãƒ—ãŒã¯ã¿å‡ºã•ãªã„ã‚ˆã†ã« */
            font-family: sans-serif;
            background-color: #f5f5f5; /* èƒŒæ™¯è‰²ã‚’è¿½åŠ  */
        }

        #ticker-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            box-sizing: border-box;
            background-color: #ffffff; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ†ãƒ­ãƒƒãƒ—èƒŒæ™¯è‰² */
            color: #222222; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ†ãƒ­ãƒƒãƒ—æ–‡å­—è‰² */
            padding: 5px 0; /* ä¸Šä¸‹ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¿½åŠ  */
            z-index: 999; /* ä»–ã®è¦ç´ ã®ä¸Šã«è¡¨ç¤º */
            border-top: 1px solid #ddd;
        }

        #ticker-text {
            display: inline-block;
            font-size: 32px;
            font-weight: 400;
            animation: scroll-left linear infinite; /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“ã‚’JSã§è¨­å®š */
            padding-left: 100%; /* åˆæœŸè¡¨ç¤ºã‚’ç”»é¢å¤–ã‹ã‚‰ã«ã™ã‚‹ */
        }

        @keyframes scroll-left {
            0% { transform: translateX(0%); }
            100% { transform: translateX(-100%); }
        }

        #controller {
            position: absolute; /* åˆæœŸå€¤ã‚’absoluteã«å¤‰æ›´ */
            top: 20px;
            left: 20px;
            width: 400px;
            min-width: 250px;
            min-height: 200px;
            background: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1000; /* ãƒ†ãƒ­ãƒƒãƒ—ã®ä¸Šã«è¡¨ç¤º */
            resize: both; /* ãƒªã‚µã‚¤ã‚ºã‚’è¨±å¯ */
            overflow: auto; /* å†…å®¹ãŒã¯ã¿å‡ºã—ãŸã‚‰ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
            display: block; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¡¨ç¤º */
            font-size: 14px; /* ãƒ™ãƒ¼ã‚¹ã®ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º (JSã§å‹•çš„ã«å¤‰æ›´) */
            box-sizing: border-box;
        }

        #controller.dragging {
            cursor: grabbing;
        }

        #controller h3 {
            margin-top: 0;
            font-size: 1.2em; /* ç›¸å¯¾å˜ä½ */
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        #controller label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
            font-size: 1em; /* ç›¸å¯¾å˜ä½ */
        }

        #controller input[type="text"],
        #controller input[type="number"],
        #controller select,
        #controller textarea {
            width: calc(100% - 12px);
            padding: 0.6em; /* ç›¸å¯¾å˜ä½ */
            margin-bottom: 0.8em; /* ç›¸å¯¾å˜ä½ */
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1em; /* ç›¸å¯¾å˜ä½ */
        }

        #controller input[type="color"] {
            width: 80px;
            height: 30px;
            border: none;
            padding: 0;
            vertical-align: middle;
            margin-bottom: 10px; /* å›ºå®š */
        }

        #controller button {
            background-color: #007bff;
            color: white;
            padding: 0.6em 1em; /* ç›¸å¯¾å˜ä½ */
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em; /* ç›¸å¯¾å˜ä½ */
            transition: background-color 0.2s ease;
            margin-right: 0.5em; /* ç›¸å¯¾å˜ä½ */
            margin-bottom: 0.5em; /* ç›¸å¯¾å˜ä½ */
        }

        #controller button:hover {
            background-color: #0056b3;
        }

        #controller button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        #controller .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8em; /* ç›¸å¯¾å˜ä½ */
            margin-bottom: 1em; /* ç›¸å¯¾å˜ä½ */
        }

        .preview-text {
            margin-top: 1.2em; /* ç›¸å¯¾å˜ä½ */
            padding: 0.8em; /* ç›¸å¯¾å˜ä½ */
            border: 1px dashed #aaa;
            background-color: #e9e9e9;
            font-size: 1.1em; /* ç›¸å¯¾å˜ä½ */
            text-align: center;
            color: #333;
            border-radius: 4px;
        }

        /* ç”»é¢ä¸Šéƒ¨ã®è¨­å®šè¡¨ç¤º/éè¡¨ç¤ºãƒœã‚¿ãƒ³ */
        #toggle-controller-btn {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 1001; /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚ˆã‚Šã‚‚ã•ã‚‰ã«ä¸Š */
            padding: 6px 16px;
            font-size: 16px;
            border-radius: 8px;
            background: #fff;
            border: 1px solid #ccc;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .modal {
            display: none; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§éè¡¨ç¤º */
            position: fixed; /* ç”»é¢å…¨ä½“ã‚’è¦†ã† */
            z-index: 2000; /* æœ€å‰é¢ã«è¡¨ç¤º */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto; /* å†…å®¹ãŒã¯ã¿å‡ºã—ãŸã‚‰ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã« */
            background-color: rgba(0,0,0,0.7); /* åŠé€æ˜ã®é»’ã„èƒŒæ™¯ */
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto; /* ä¸Šä¸‹ã«å°‘ã—ä½™ç™½ã‚’æŒãŸã›ã‚‹ */
            padding: 25px;
            border: 1px solid #888;
            border-radius: 10px;
            width: 80%; /* å¹…ã‚’èª¿æ•´ */
            max-width: 700px; /* æœ€å¤§å¹…ã‚’è¨­å®š */
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
            animation-name: animatetop;
            animation-duration: 0.4s;
            max-height: 90vh; /* ç¸¦é•·ã«ãªã‚Šã™ããªã„ã‚ˆã†ã« */
            overflow-y: auto; /* å†…å®¹ãŒç¸¦é•·ã«ãªã£ãŸã‚‰ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
        }

        @keyframes animatetop {
            from {top: -300px; opacity: 0}
            to {top: 0; opacity: 1}
        }

        .close-button {
            color: #aaa;
            float: right;
            font-size: 30px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
        }

        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .modal-content h4 {
            color: #007bff;
            margin-top: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            font-size: 1.1em;
        }
        .modal-content ul {
            padding-left: 20px;
        }
        .modal-content li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div id="ticker-container">
        <span id="ticker-text">RSSãƒ•ã‚£ãƒ¼ãƒ‰ã‹ã‚‰èª­ã¿è¾¼ã¾ã‚ŒãŸæƒ…å ±ã€ã¾ãŸã¯æ‰‹å‹•ã§å…¥åŠ›ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</span>
    </div>

    <button id="toggle-controller-btn">âš™ï¸ è¨­å®šè¡¨ç¤º/éè¡¨ç¤º</button>

    <div id="controller">
        <h3>ãƒ†ãƒ­ãƒƒãƒ—è¨­å®šãƒ‘ãƒãƒ«</h3>

        <div class="button-group">
            <button id="play-btn">â–¶ï¸ å†ç”Ÿ</button>
            <button id="pause-btn">â¸ï¸ ä¸€æ™‚åœæ­¢</button>
            <button id="restart-btn">ğŸ”„ æœ€åˆã‹ã‚‰è¡¨ç¤º</button>
            <button id="manual-btn">ğŸ“š ä½¿ç”¨æ–¹æ³•</button>
        </div>

        <div class="button-group">
            <button id="speech-on-btn">ğŸ”Š èª­ã¿ä¸Šã’ON</button>
            <button id="speech-off-btn">ğŸ”‡ èª­ã¿ä¸Šã’OFF</button>
        </div>

        <label for="speech-rate-slider">èª­ã¿ä¸Šã’é€Ÿåº¦:</label>
        <input type="range" id="speech-rate-slider" min="0.5" max="2" step="0.1" value="1">
        <p style="font-size: 0.8em; color: #666; margin-top: -8px; margin-bottom: 10px;">0.5 (é…ã„) ã€œ 2.0 (é€Ÿã„)</p>


        <div class="button-group">
            <button id="zoom-in-btn">ï¼‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼æ‹¡å¤§</button>
            <button id="zoom-out-btn">âˆ’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ç¸®å°</button>
        </div>

        <div class="button-group">
            <button id="font-size-up-btn">ï¼‹æ–‡å­—å¤§</button>
            <button id="font-size-down-btn">âˆ’æ–‡å­—å°</button>
        </div>

        <label for="rss-url-input">RSSãƒ•ã‚£ãƒ¼ãƒ‰URL (è¤‡æ•°URLã¯ã‚«ãƒ³ãƒã‹ã‚¹ãƒšãƒ¼ã‚¹ã§åŒºåˆ‡ã‚‹):</label>
        <textarea id="rss-url-input" rows="3" placeholder="ä¾‹: https://news.yahoo.co.jp/rss/topics/top-picks.xml, https://example.com/feed"></textarea>
        <button id="load-rss-button">RSSã‚’èª­ã¿è¾¼ã‚€</button>
        <button id="stop-rss-button">RSSè‡ªå‹•æ›´æ–°åœæ­¢</button>

        <label for="ticker-input">æ‰‹å‹•å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ:</label>
        <textarea id="ticker-input" rows="3" placeholder="ãƒ†ãƒ­ãƒƒãƒ—ã«è¡¨ç¤ºã—ãŸã„ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>

        <label for="speed-input">é€Ÿåº¦:</label>
        <input type="number" id="speed-input" value="0" min="-1000" max="1000" step="10">
        <p style="font-size: 0.8em; color: #666; margin-top: -8px; margin-bottom: 10px;">ãƒã‚¤ãƒŠã‚¹å€¤ã«ã™ã‚‹ã¨ã•ã‚‰ã«é…ããªã‚Šã¾ã™ã€‚</p>


        <label for="size-slider">æ–‡å­—ã‚µã‚¤ã‚º:</label>
        <input type="range" id="size-slider" min="12" max="120" value="32">

        <label for="font-select">ãƒ•ã‚©ãƒ³ãƒˆ:</label>
        <select id="font-select">
            <option value="sans-serif">ã‚´ã‚·ãƒƒã‚¯ä½“ (sans-serif)</option>
            <option value="serif">æ˜æœä½“ (serif)</option>
            <option value="monospace">ç­‰å¹… (monospace)</option>
            <option value="Arial, sans-serif">Arial</option>
            <option value="ãƒ¡ã‚¤ãƒªã‚ª, Meiryo, sans-serif">ãƒ¡ã‚¤ãƒªã‚ª</option>
            <option value="æ¸¸ã‚´ã‚·ãƒƒã‚¯, YuGothic, sans-serif">æ¸¸ã‚´ã‚·ãƒƒã‚¯</option>
            <option value="Times New Roman, serif">Times New Roman</option>
        </select>

        <label for="weight-slider">æ–‡å­—ã®å¤ªã•:</label>
        <input type="range" id="weight-slider" min="100" max="900" step="100" value="400">

        <label for="text-color-picker">æ–‡å­—è‰²:</label>
        <input type="color" id="text-color-picker" value="#222222">

        <label for="bg-color-picker">èƒŒæ™¯è‰²:</label>
        <input type="color" id="bg-color-picker" value="#ffffff">

        <div class="preview-text">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆ</div>

        <button id="reset-settings-btn" style="margin-top: 15px;">è¨­å®šåˆæœŸåŒ–</button>
    </div>

    <div id="manual-modal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h3>ğŸ“š ãƒ†ãƒ­ãƒƒãƒ—è¡¨ç¤ºãƒ„ãƒ¼ãƒ« - ä½¿ç”¨æ–¹æ³•</h3>

            <h4>1. ãƒ†ãƒ­ãƒƒãƒ—ã®å†ç”Ÿãƒ»ä¸€æ™‚åœæ­¢ãƒ»å†é–‹</h4>
            <ul>
                <li>ã€Œâ–¶ï¸ å†ç”Ÿã€ãƒœã‚¿ãƒ³ã§ãƒ†ãƒ­ãƒƒãƒ—ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’å†é–‹ã—ã¾ã™ã€‚ä¸€æ™‚åœæ­¢ã—ãŸå ´æ‰€ã‹ã‚‰ç¶šããŒå†ç”Ÿã•ã‚Œã¾ã™ã€‚</li>
                <li>ã€Œâ¸ï¸ ä¸€æ™‚åœæ­¢ã€ãƒœã‚¿ãƒ³ã§ãƒ†ãƒ­ãƒƒãƒ—ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’åœæ­¢ã—ã¾ã™ã€‚</li>
                <li>ã€ŒğŸ”„ **æœ€åˆã‹ã‚‰è¡¨ç¤º**ã€ãƒœã‚¿ãƒ³ã§ã€ãƒ†ãƒ­ãƒƒãƒ—ã‚’åœæ­¢ã—ã€å†èª­ã¿è¾¼ã¿ã—ã¦æœ€åˆã‹ã‚‰è¡¨ç¤ºã—ç›´ã—ã¾ã™ã€‚RSSè‡ªå‹•æ›´æ–°ãŒæœ‰åŠ¹ãªå ´åˆã¯ã€æœ€æ–°ã®RSSãƒ•ã‚£ãƒ¼ãƒ‰ã‚’å†åº¦èª­ã¿è¾¼ã¿ã¾ã™ã€‚</li>
            </ul>

            <h4>2. ãƒ†ãƒ­ãƒƒãƒ—ã®èª­ã¿ä¸Šã’ (éŸ³å£°)</h4>
            <ul>
                <li>ã€ŒğŸ”Š èª­ã¿ä¸Šã’ONã€ãƒœã‚¿ãƒ³ã§ãƒ†ãƒ­ãƒƒãƒ—ã®å†…å®¹ã‚’éŸ³å£°ã§èª­ã¿ä¸Šã’ã¾ã™ã€‚**ãƒ†ãƒ­ãƒƒãƒ—ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã«åˆã‚ã›ã¦ã€è‡ªå‹•ã§èª­ã¿ä¸Šã’ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒèª¿æ•´ã•ã‚Œã¾ã™ã€‚**</li>
                <li>ã€ŒğŸ”‡ èª­ã¿ä¸Šã’OFFã€ãƒœã‚¿ãƒ³ã§èª­ã¿ä¸Šã’ã‚’åœæ­¢ã—ã¾ã™ã€‚</li>
                <li>ã€Œ**èª­ã¿ä¸Šã’é€Ÿåº¦**ã€ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§ã€èª­ã¿ä¸Šã’ã®é€Ÿã•ã‚’èª¿æ•´ã§ãã¾ã™ã€‚</li>
                <li>**ãƒ†ãƒ­ãƒƒãƒ—ã®å†ç”Ÿãƒ»ä¸€æ™‚åœæ­¢ã¨é€£å‹•ã—ã¦ã€èª­ã¿ä¸Šã’ã‚‚ä¸€æ™‚åœæ­¢ãƒ»å†é–‹ã•ã‚Œã¾ã™ã€‚**</li>
            </ul>

            <h4>3. ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«ã®æ‹¡å¤§ãƒ»ç¸®å°</h4>
            <ul>
                <li>ã€Œï¼‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼æ‹¡å¤§ã€ãƒœã‚¿ãƒ³ã§ã“ã®æ“ä½œãƒ‘ãƒãƒ«ã®ã‚µã‚¤ã‚ºã‚’å¤§ããã—ã¾ã™ã€‚</li>
                <li>ã€Œâˆ’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ç¸®å°ã€ãƒœã‚¿ãƒ³ã§ã“ã®æ“ä½œãƒ‘ãƒãƒ«ã®ã‚µã‚¤ã‚ºã‚’å°ã•ãã—ã¾ã™ã€‚</li>
                <li>ãƒ‘ãƒãƒ«ã®å³ä¸‹ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã™ã‚‹ã“ã¨ã§ã‚‚ã‚µã‚¤ã‚ºå¤‰æ›´ãŒå¯èƒ½ã§ã™ã€‚**ãƒ‘ãƒãƒ«å†…ã®æ–‡å­—ã‚„ãƒœã‚¿ãƒ³ã‚‚é€£å‹•ã—ã¦å¤§ãããªã‚Šã¾ã™ã€‚**</li>
            </ul>

            <h4>4. ãƒ†ãƒ­ãƒƒãƒ—ã®æ–‡å­—ã‚µã‚¤ã‚ºå¤‰æ›´</h4>
            <ul>
                <li>ã€Œï¼‹æ–‡å­—å¤§ã€ãƒœã‚¿ãƒ³ã§ãƒ†ãƒ­ãƒƒãƒ—ã®æ–‡å­—ã‚’å¤§ããã—ã¾ã™ã€‚</li>
                <li>ã€Œâˆ’æ–‡å­—å°ã€ãƒœã‚¿ãƒ³ã§ãƒ†ãƒ­ãƒƒãƒ—ã®æ–‡å­—ã‚’å°ã•ãã—ã¾ã™ã€‚</li>
                <li>ã€Œæ–‡å­—ã‚µã‚¤ã‚ºã€ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã™ã‚‹ã“ã¨ã§ã‚‚å¤‰æ›´ã§ãã¾ã™ã€‚</li>
            </ul>

            <h4>5. RSSãƒ•ã‚£ãƒ¼ãƒ‰ã®è¡¨ç¤º</h4>
            <ul>
                <li>ã€ŒRSSãƒ•ã‚£ãƒ¼ãƒ‰URLã€ã®ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«ã€è¡¨ç¤ºã—ãŸã„RSSãƒ•ã‚£ãƒ¼ãƒ‰ã®URLã‚’å…¥åŠ›ã—ã¾ã™ã€‚è¤‡æ•°ã‚ã‚‹å ´åˆã¯ã€ã‚«ãƒ³ãƒ (`,`) ã¾ãŸã¯ã‚¹ãƒšãƒ¼ã‚¹ã§åŒºåˆ‡ã£ã¦ãã ã•ã„ã€‚</li>
                <li>ã€ŒRSSã‚’èª­ã¿è¾¼ã‚€ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€å…¥åŠ›ã•ã‚ŒãŸRSSãƒ•ã‚£ãƒ¼ãƒ‰ã‹ã‚‰æœ€æ–°ã®ãƒ‹ãƒ¥ãƒ¼ã‚¹ãŒå–å¾—ã•ã‚Œã€ãƒ†ãƒ­ãƒƒãƒ—ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚è‡ªå‹•æ›´æ–°ãŒé–‹å§‹ã•ã‚Œã¾ã™ã€‚</li>
                <li>ã€ŒRSSè‡ªå‹•æ›´æ–°åœæ­¢ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€RSSãƒ•ã‚£ãƒ¼ãƒ‰ã®è‡ªå‹•æ›´æ–°ãŒæ­¢ã¾ã‚Šã€æ‰‹å‹•å…¥åŠ›ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚</li>
                <li>**RSSã®è‡ªå‹•æ›´æ–°ã¯ã€ç¾åœ¨ã®ãƒ†ãƒ­ãƒƒãƒ—ãŒç”»é¢ã‚’ä¸€å‘¨ã™ã‚‹ãŸã³ã«è¡Œã‚ã‚Œã¾ã™ã€‚**</li>
                <li>**ãƒ’ãƒ³ãƒˆ**: èª­ã¿è¾¼ã¿ã‚’å®‰å®šã•ã›ã‚‹ãŸã‚ã€é…ã„ã‚µã‚¤ãƒˆã‚„é »ç¹ã«ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã‚µã‚¤ãƒˆã¯ã€ä»–ã®RSSãƒ•ã‚£ãƒ¼ãƒ‰ã¨ã¯åˆ†ã‘ã¦å…¥åŠ›ã™ã‚‹ã‹ã€æ‰‹å‹•å…¥åŠ›ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚</li>
            </ul>

            <h4>6. æ‰‹å‹•å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆã®è¡¨ç¤º</h4>
            <ul>
                <li>ã€Œæ‰‹å‹•å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆã€ã®ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«ã€è‡ªç”±ã«è¡¨ç¤ºã—ãŸã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¾ã™ã€‚</li>
                <li>RSSè‡ªå‹•æ›´æ–°ãŒåœæ­¢ã—ã¦ã„ã‚‹é–“ã€ã“ã®ãƒ†ã‚­ã‚¹ãƒˆãŒãƒ†ãƒ­ãƒƒãƒ—ã¨ã—ã¦æµã‚Œã¾ã™ã€‚</li>
            </ul>

            <h4>7. ãƒ†ãƒ­ãƒƒãƒ—ã®é€Ÿåº¦èª¿æ•´</h4>
            <ul>
                <li>ã€Œé€Ÿåº¦ã€å…¥åŠ›æ¬„ã«æ•°å€¤ã‚’å…¥åŠ›ã—ã¾ã™ã€‚</li>
                <li>ã€Œ0ã€ãŒæ¨™æº–é€Ÿåº¦ã§ã™ã€‚</li>
                <li>ãƒ—ãƒ©ã‚¹ã®å€¤ã‚’å¤§ããã™ã‚‹ã»ã©ãƒ†ãƒ­ãƒƒãƒ—ãŒé€Ÿãæµã‚Œã¾ã™ã€‚</li>
                <li>ãƒã‚¤ãƒŠã‚¹ã®å€¤ã‚’å¤§ããã™ã‚‹ã»ã©ãƒ†ãƒ­ãƒƒãƒ—ãŒã•ã‚‰ã«é…ãæµã‚Œã¾ã™ã€‚</li>
                <li>**ãƒ†ãƒ­ãƒƒãƒ—ã®æ–‡å­—æ•°ã«å¿œã˜ã¦è‡ªå‹•çš„ã«æœ€é©ãªé€Ÿåº¦ã«èª¿æ•´ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚**</li>
            </ul>

            <h4>8. ãã®ä»–ã®è¡¨ç¤ºè¨­å®š</h4>
            <ul>
                <li>ã€Œãƒ•ã‚©ãƒ³ãƒˆã€ã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‹ã‚‰ã€ãƒ†ãƒ­ãƒƒãƒ—ã®ãƒ•ã‚©ãƒ³ãƒˆã‚’å¤‰æ›´ã§ãã¾ã™ã€‚</li>
                <li>ã€Œæ–‡å­—ã®å¤ªã•ã€ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§ã€ãƒ†ãƒ­ãƒƒãƒ—ã®æ–‡å­—ã®å¤ªã•ã‚’èª¿æ•´ã§ãã¾ã™ã€‚</li>
                <li>ã€Œæ–‡å­—è‰²ã€ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ã§ã€ãƒ†ãƒ­ãƒƒãƒ—ã®æ–‡å­—ã®è‰²ã‚’å¤‰æ›´ã§ãã¾ã™ã€‚</li>
                <li>ã€ŒèƒŒæ™¯è‰²ã€ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ã§ã€ãƒ†ãƒ­ãƒƒãƒ—ã®èƒŒæ™¯ã®è‰²ã‚’å¤‰æ›´ã§ãã¾ã™ã€‚</li>
            </ul>

            <h4>9. è¨­å®šã®åˆæœŸåŒ–ãƒ»ä¿å­˜ãƒ»è¡¨ç¤º/éè¡¨ç¤º</h4>
            <ul>
                <li>ã€Œè¨­å®šåˆæœŸåŒ–ã€ãƒœã‚¿ãƒ³ã§ã€ã™ã¹ã¦ã®è¨­å®šã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã—ã¾ã™ã€‚</li>
                <li>å„è¨­å®šã¯è‡ªå‹•çš„ã«ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã‚‹ãŸã‚ã€æ¬¡å›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã‚‚åŒã˜è¨­å®šã§åˆ©ç”¨ã§ãã¾ã™ã€‚</li>
                <li>å·¦ä¸Šã®ã€Œâš™ï¸ è¨­å®šè¡¨ç¤º/éè¡¨ç¤ºã€ãƒœã‚¿ãƒ³ã§ã€ã“ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«ã‚’éš ã—ãŸã‚Šè¡¨ç¤ºã—ãŸã‚Šã§ãã¾ã™ã€‚</li>
                <li>ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«ã¯ãƒ‰ãƒ©ãƒƒã‚°ã§ç§»å‹•ã€å³ä¸‹ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã§ã‚µã‚¤ã‚ºå¤‰æ›´ãŒå¯èƒ½ã§ã™ã€‚</li>
            </ul>
        </div>
    </div>

    <script>
        // Google Apps Script (GAS) ãƒ—ãƒ­ã‚­ã‚·ã®URL
        const GAS_PROXY_URL = 'https://script.google.com/macros/s/AKfycbzrvWwKI8q5InEHJaR1qKWGeJlZzHjRc2RUxdBvHmU9Raxl_FjM-kgOC1MyjGcgRs6M/exec';

        // ãƒ–ãƒ©ã‚¦ã‚¶ã‚¿ãƒ–ç”¨ã®å‹•çš„ã‚¢ã‚¤ã‚³ãƒ³ (Data URL)
        const PLAY_ICON_DATA_URL = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><polygon points="20,10 80,50 20,90" fill="green"/></svg>';
        const PAUSE_ICON_DATA_URL = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect x="20" y="10" width="25" height="80" fill="red"/><rect x="55" y="10" width="25" height="80" fill="red"/></svg>';

        // DOMè¦ç´ ã®å–å¾—
        const tickerContainer = document.getElementById('ticker-container');
        const tickerText = document.getElementById('ticker-text');
        const controller = document.getElementById('controller');
        const rssUrlInput = document.getElementById('rss-url-input');
        const loadRssButton = document.getElementById('load-rss-button');
        const stopRssButton = document.getElementById('stop-rss-button');
        const tickerInput = document.getElementById('ticker-input');
        const speedInput = document.getElementById('speed-input');
        const sizeSlider = document.getElementById('size-slider');
        const weightSlider = document.getElementById('weight-slider');
        const previewText = controller.querySelector('.preview-text');
        const fontSelect = document.getElementById('font-select');
        const textColorPicker = document.getElementById('text-color-picker');
        const bgColorPicker = document.getElementById('bg-color-picker');
        const speechRateSlider = document.getElementById('speech-rate-slider');

        // ãƒœã‚¿ãƒ³è¦ç´ 
        const toggleControllerBtn = document.getElementById('toggle-controller-btn');
        const playBtn = document.getElementById('play-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const restartBtn = document.getElementById('restart-btn');
        const speechOnBtn = document.getElementById('speech-on-btn');
        const speechOffBtn = document.getElementById('speech-off-btn');
        const zoomInBtn = document.getElementById('zoom-in-btn');
        const zoomOutBtn = document.getElementById('zoom-out-btn');
        const fontSizeUpBtn = document.getElementById('font-size-up-btn');
        const fontSizeDownBtn = document.getElementById('font-size-down-btn');
        const resetSettingsBtn = document.getElementById('reset-settings-btn');
        const manualBtn = document.getElementById('manual-btn');
        const manualModal = document.getElementById('manual-modal');
        const closeButton = manualModal.querySelector('.close-button');

        // çŠ¶æ…‹å¤‰æ•°
        let currentSpeed = parseInt(speedInput.value);
        let currentSize = parseInt(sizeSlider.value);
        let currentText = tickerInput.value;
        let currentFont = fontSelect.value;
        let currentWeight = parseInt(weightSlider.value);
        let currentTextColor = textColorPicker.value;
        let currentBgColor = bgColorPicker.value;
        let currentSpeechRate = parseFloat(speechRateSlider.value);

        let isRssAutoUpdating = false;
        let isTickerPaused = false;
        let isSpeechOn = false;
        let currentUtterance = null; // ç¾åœ¨èª­ã¿ä¸Šã’ä¸­ã®Utteranceã‚’ä¿æŒ
        let speechQueue = []; // èª­ã¿ä¸Šã’å¾…ã¡ã®ãƒ†ã‚­ã‚¹ãƒˆã‚­ãƒ¥ãƒ¼
        let speakingIndex = 0; // ç¾åœ¨èª­ã¿ä¸Šã’ã¦ã„ã‚‹ãƒ†ã‚­ã‚¹ãƒˆã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

        // ãƒ†ã‚­ã‚¹ãƒˆåˆ†å‰²ç”¨ã®æ­£è¦è¡¨ç¾ï¼ˆRSSã‚¿ã‚¤ãƒˆãƒ«ã‚„æ‰‹å‹•å…¥åŠ›ã®åŒºåˆ‡ã‚Šã«ä½¿ã†ï¼‰
        // ğŸŒ¸ã€...ã€‘ğŸŒ¸ ã®ã‚ˆã†ãªå½¢å¼ã‚„ã€ â—‡ ã‚’åŒºåˆ‡ã‚Šã¨ã™ã‚‹
        const TEXT_SPLIT_REGEX = /(ğŸŒ¸ã€[^ã€‘]+ã€‘ğŸŒ¸|â—‡)/g;

        /**
         * ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’æ›´æ–°ã™ã‚‹é–¢æ•°ã€‚
         * @param {number} baseWidth - ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ç¾åœ¨ã®å¹…ã€‚
         */
        function updateControllerFontSize(baseWidth) {
            const minWidth = 250;
            const maxWidth = 800;
            const minFontSize = 12;
            const maxFontSize = 20;

            let newFontSize;
            if (baseWidth <= minWidth) {
                newFontSize = minFontSize;
            } else if (baseWidth >= maxWidth) {
                newFontSize = maxFontSize;
            } else {
                newFontSize = minFontSize + (maxFontSize - minFontSize) * ((baseWidth - minWidth) / (maxWidth - minWidth));
            }
            
            controller.style.fontSize = `${newFontSize}px`;
        }

        /**
         * ãƒ†ãƒ­ãƒƒãƒ—ã®è¡¨ç¤ºã¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°ã€‚
         * @param {boolean} resetAnimation - ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æœ€åˆã‹ã‚‰ãƒªã‚»ãƒƒãƒˆã™ã‚‹ã‹ã©ã†ã‹ (restartãƒœã‚¿ãƒ³ç”¨)
         */
        function updateTicker(resetAnimation = false) {
            tickerText.style.fontSize = `${currentSize}px`;
            tickerText.style.fontFamily = currentFont;
            tickerText.style.fontWeight = currentWeight;
            tickerText.style.color = currentTextColor;
            tickerContainer.style.backgroundColor = currentBgColor;

            tickerText.textContent = currentText;

            previewText.style.fontSize = `${currentSize}px`;
            previewText.style.fontFamily = currentFont;
            previewText.style.fontWeight = currentWeight;
            previewText.style.color = currentTextColor;
            previewText.style.backgroundColor = currentBgColor;
            previewText.textContent = `ã‚µã‚¤ã‚º: ${currentSize}px, é€Ÿåº¦: ${currentSpeed}, æ›¸ä½“: ${currentFont}, å¤ªã•: ${currentWeight}`;

            if (resetAnimation) {
                tickerText.style.animation = 'none';
                tickerText.style.transform = 'translateX(0%)';
                void tickerText.offsetWidth;
            } else {
                tickerText.style.animation = 'none';
                void tickerText.offsetWidth;
            }

            const tickerTextWidth = tickerText.scrollWidth;
            const viewportWidth = window.innerWidth;

            const basePixelsPerSecond = 100; 

            let speedMultiplier;
            if (currentSpeed >= 0) {
                speedMultiplier = 1 + (currentSpeed / 1000); 
            } else {
                speedMultiplier = 1 + (currentSpeed / 2000); 
            }
            speedMultiplier = Math.max(0.1, speedMultiplier);

            const distanceToScroll = tickerTextWidth + viewportWidth;
            let animationDuration = distanceToScroll / (basePixelsPerSecond * speedMultiplier);

            animationDuration = Math.max(1, animationDuration);
            animationDuration = Math.min(6000, animationDuration);

            tickerText.style.animation = `scroll-left ${animationDuration}s linear infinite`;
            tickerText.style.animationPlayState = isTickerPaused ? 'paused' : 'running';

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®å†é–‹æ™‚ã«èª­ã¿ä¸Šã’ã‚’ãƒªã‚»ãƒƒãƒˆãƒ»é–‹å§‹
            if (!isTickerPaused) {
                // æ–°ã—ã„ãƒ†ã‚­ã‚¹ãƒˆã®å ´åˆã€ã¾ãŸã¯å†é–‹æ™‚ã«èª­ã¿ä¸Šã’ã‚’æœ€åˆã‹ã‚‰é–‹å§‹ã™ã‚‹å ´åˆ
                startSpeechSync();
            } else {
                // åœæ­¢æ™‚ã¯èª­ã¿ä¸Šã’ã‚‚åœæ­¢
                stopSpeech();
            }
        }

        /**
         * RSSãƒ•ã‚£ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹é–¢æ•°ã€‚rss2jsonã¨GASãƒ—ãƒ­ã‚­ã‚·ã‚’ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã—ã¦ä½¿ç”¨ã€‚
         */
        async function fetchRssFeed(url) {
            try {
                const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}`;
                const res = await fetch(apiUrl);
                if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
                const data = await res.json();

                if (data.items && data.items.length > 0) {
                    return data.items.map(item => `ğŸŒ¸ã€${item.title}ã€‘ğŸŒ¸`);
                } else {
                    return [`ğŸ’¦RSSå–å¾—å¤±æ•— (ãƒ‡ãƒ¼ã‚¿ãªã—): ${url}`];
                }
            } catch (error) {
                console.error('RSSãƒ•ã‚£ãƒ¼ãƒ‰ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ (rss2json):', error);
                return [`ğŸ’¦RSSå–å¾—å¤±æ•— (rss2jsonã‚¨ãƒ©ãƒ¼): ${url}`];
            }
        }

        async function fetchRssFeedWithGasProxy(url) {
            try {
                const proxyUrl = `${GAS_PROXY_URL}?url=${encodeURIComponent(url)}`;
                const response = await fetch(proxyUrl);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const xmlText = await response.text();
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, "text/xml");

                const items = xmlDoc.querySelectorAll('item');
                const entries = xmlDoc.querySelectorAll('entry');

                let feedTexts = [];
                if (items.length > 0) {
                    items.forEach(item => {
                        const title = item.querySelector('title')?.textContent || 'ç„¡é¡Œ';
                        feedTexts.push(`ğŸŒ¸ã€${title}ã€‘ğŸŒ¸`);
                    });
                } else if (entries.length > 0) {
                    entries.forEach(entry => {
                        const title = entry.querySelector('title')?.textContent || 'ç„¡é¡Œ';
                        feedTexts.push(`ğŸŒ¸ã€${title}ã€‘ğŸŒ¸`);
                    });
                }
                return feedTexts;
            } catch (gasError) {
                console.error('RSSãƒ•ã‚£ãƒ¼ãƒ‰ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ (GASãƒ—ãƒ­ã‚­ã‚·):', gasError);
                return [`ğŸ’¦RSSå–å¾—å¤±æ•— (GASãƒ—ãƒ­ã‚­ã‚·ã‚¨ãƒ©ãƒ¼): ${url}`];
            }
        }

        /**
         * è¤‡æ•°ã®RSSãƒ•ã‚£ãƒ¼ãƒ‰ã‚’å–å¾—ã—ã€ãƒ†ãƒ­ãƒƒãƒ—ã«è¡¨ç¤ºã™ã‚‹é–¢æ•°ã€‚
         * @param {boolean} isInitialLoad - åˆå›èª­ã¿è¾¼ã¿ã‹ã©ã†ã‹ã€‚
         * @param {boolean} isRestartTriggered - ã€Œæœ€åˆã‹ã‚‰è¡¨ç¤ºã€ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‹ã€‚
         */
        async function fetchAndDisplayMultipleRss(isInitialLoad = false, isRestartTriggered = false) {
            const urls = rssUrlInput.value
                .split(/[\s,]+/)
                .map(u => u.trim())
                .filter(u => u);

            if (urls.length === 0) {
                currentText = 'RSSãƒ•ã‚£ãƒ¼ãƒ‰ã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
                tickerInput.value = currentText;
                updateTicker(isRestartTriggered);
                return;
            }

            if (isInitialLoad || isRestartTriggered) {
                loadRssButton.disabled = true;
                loadRssButton.textContent = 'èª­ã¿è¾¼ã¿ä¸­...';
            }

            let allTexts = [];
            for (const url of urls) {
                let textsFromRss2json = await fetchRssFeed(url);
                if (textsFromRss2json.length > 0 && !textsFromRss2json[0].includes('RSSå–å¾—å¤±æ•—')) {
                    allTexts = allTexts.concat(textsFromRss2json);
                } else {
                    let textsFromGas = await fetchRssFeedWithGasProxy(url);
                    allTexts = allTexts.concat(textsFromGas);
                }
            }
            const combinedText = allTexts.join(' â—‡ ');

            currentText = combinedText || 'RSSãƒ•ã‚£ãƒ¼ãƒ‰ã‹ã‚‰æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚URLã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
            tickerInput.value = currentText;
            updateTicker(isRestartTriggered);

            if (isInitialLoad || isRestartTriggered) {
                loadRssButton.disabled = false;
                loadRssButton.textContent = 'RSSã‚’èª­ã¿è¾¼ã‚€';
            }
        }

        /**
         * RSSè‡ªå‹•æ›´æ–°ã‚’é–‹å§‹ã™ã‚‹é–¢æ•°ã€‚
         */
        function startRssAutoUpdates() {
            if (isRssAutoUpdating) return;

            isRssAutoUpdating = true;
            loadRssButton.disabled = true;
            loadRssButton.textContent = 'RSSè‡ªå‹•æ›´æ–°ä¸­';
            stopRssButton.disabled = false;
            tickerInput.disabled = true;
            console.log("RSSè‡ªå‹•æ›´æ–°ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸã€‚");
        }

        /**
         * RSSè‡ªå‹•æ›´æ–°ã‚’åœæ­¢ã™ã‚‹é–¢æ•°ã€‚
         */
        function stopRssUpdates() {
            isRssAutoUpdating = false;
            // Animation iteration listenerã¯ç¶™ç¶šã—ã¦ã‚‚è‰¯ã„ï¼ˆãƒ†ãƒ­ãƒƒãƒ—ãŒä¸€å‘¨ã—ãŸã“ã¨è‡ªä½“ã¯æ¤œçŸ¥ã™ã‚‹ãŸã‚ï¼‰
            // å¿…è¦ã«å¿œã˜ã¦ `tickerText.removeEventListener` ã‚’è¿½åŠ 

            loadRssButton.disabled = false;
            loadRssButton.textContent = 'RSSã‚’èª­ã¿è¾¼ã‚€';
            stopRssButton.disabled = true;
            tickerInput.disabled = false;
            alert('RSSãƒ•ã‚£ãƒ¼ãƒ‰ã®è‡ªå‹•æ›´æ–°ã‚’åœæ­¢ã—ã¾ã—ãŸã€‚');
            console.log("RSSè‡ªå‹•æ›´æ–°ãŒåœæ­¢ã—ã¾ã—ãŸã€‚");
        }

        /**
         * ãƒ†ãƒ­ãƒƒãƒ—ãŒä¸€å‘¨ã™ã‚‹ãŸã³ã«RSSã‚’æ›´æ–°ã™ã‚‹ãƒªã‚¹ãƒŠãƒ¼ã‚’å†è¨­å®šã™ã‚‹ã€‚
         */
        function setupAnimationIterationListener() {
            if (tickerText.animation_iteration_listener) {
                tickerText.removeEventListener('animationiteration', tickerText.animation_iteration_listener);
            }

            tickerText.animation_iteration_listener = () => {
                if (isRssAutoUpdating) {
                    console.log("animationiterationæ¤œå‡ºï¼šãƒ†ãƒ­ãƒƒãƒ—ãŒä¸€å‘¨ã—ã¾ã—ãŸã€‚æ¬¡ã®RSSæ›´æ–°ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚");
                    fetchAndDisplayMultipleRss(false, true);
                }
            };
            tickerText.addEventListener('animationiteration', tickerText.animation_iteration_listener);
        }

        setupAnimationIterationListener();


        // --- éŸ³å£°èª­ã¿ä¸Šã’åŒæœŸæ©Ÿèƒ½ ---
        let animationFrameId = null; // requestAnimationFrame ID
        const VOICE_VOLUME = 1.0; // èª­ã¿ä¸Šã’éŸ³é‡
        const VOICE_PITCH = 1.2; // èª­ã¿ä¸Šã’ãƒ”ãƒƒãƒ

        /**
         * ãƒ†ã‚­ã‚¹ãƒˆã‚’åˆ†å‰²ã—ã¦èª­ã¿ä¸Šã’ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ ã™ã‚‹
         * @param {string} text - èª­ã¿ä¸Šã’ã‚‹å…¨ä½“ã®ãƒ†ã‚­ã‚¹ãƒˆ
         */
        function prepareSpeechQueue(text) {
            speechQueue = [];
            speakingIndex = 0;
            // ğŸŒ¸ã€...ã€‘ğŸŒ¸ ã¾ãŸã¯ â—‡ ã§åˆ†å‰²
            const parts = text.split(TEXT_SPLIT_REGEX).filter(s => s.trim() !== '');

            // ç©ºã®æ–‡å­—åˆ—ã‚„ã‚¹ãƒšãƒ¼ã‚¹ã®ã¿ã®æ–‡å­—åˆ—ã‚’é™¤å¤–ã—ã¦ã‚­ãƒ¥ãƒ¼ã«æ ¼ç´
            parts.forEach(part => {
                const trimmedPart = part.trim();
                if (trimmedPart) {
                    speechQueue.push(trimmedPart);
                }
            });
            console.log("Speech queue prepared:", speechQueue);
        }

        /**
         * æŒ‡å®šã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã‚’èª­ã¿ä¸Šã’ã‚‹
         * @param {string} text - èª­ã¿ä¸Šã’ã‚‹ãƒ†ã‚­ã‚¹ãƒˆ
         */
        function speakCurrentText(text) {
            if (!window.speechSynthesis || !isSpeechOn || isTickerPaused) {
                return;
            }

            // ç¾åœ¨èª­ã¿ä¸Šã’ä¸­ã®ã‚‚ã®ãŒã‚ã‚Œã°ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            if (currentUtterance && window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
            }

            currentUtterance = new SpeechSynthesisUtterance(text);
            const voices = window.speechSynthesis.getVoices();
            const femaleVoice = voices.find(v => v.lang.startsWith('ja') && (v.name.includes('Female') || v.name.includes('å¥³æ€§') || v.name.includes('Haruka') || v.name.includes('Google æ—¥æœ¬èª')));
            currentUtterance.voice = femaleVoice || voices.find(v => v.lang.startsWith('ja'));
            currentUtterance.rate = currentSpeechRate;
            currentUtterance.pitch = VOICE_PITCH;
            currentUtterance.volume = VOICE_VOLUME;

            currentUtterance.onend = () => {
                console.log(`Finished speaking: "${text}"`);
                currentUtterance = null;
                // å¿…è¦ã«å¿œã˜ã¦æ¬¡ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚­ãƒ¥ãƒ¼ã‹ã‚‰å–ã‚Šå‡ºã™ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ 
            };
            currentUtterance.onerror = (event) => {
                console.error('SpeechSynthesisUtterance.onerror', event);
            };

            window.speechSynthesis.speak(currentUtterance);
            console.log(`Speaking: "${text}"`);
        }

        /**
         * èª­ã¿ä¸Šã’ã®åŒæœŸã‚’é–‹å§‹ã™ã‚‹
         */
        function startSpeechSync() {
            if (!isSpeechOn || isTickerPaused) {
                stopSpeech(); // èª­ã¿ä¸Šã’OFFã¾ãŸã¯ä¸€æ™‚åœæ­¢ä¸­ãªã‚‰åœæ­¢
                return;
            }

            stopSpeech(); // æ—¢å­˜ã®èª­ã¿ä¸Šã’ã¨åŒæœŸå‡¦ç†ã‚’åœæ­¢

            prepareSpeechQueue(currentText); // æ–°ã—ã„ãƒ†ã‚­ã‚¹ãƒˆã§ã‚­ãƒ¥ãƒ¼ã‚’æº–å‚™
            speakingIndex = 0; // èª­ã¿ä¸Šã’ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ

            if (speechQueue.length === 0) {
                return;
            }

            const tickerRect = tickerText.getBoundingClientRect();
            const viewportRight = window.innerWidth;

            let lastSpokenIndex = -1; // æœ€å¾Œã«èª­ã¿ä¸Šã’ãŸãƒ†ã‚­ã‚¹ãƒˆã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

            function animateSpeech() {
                if (isTickerPaused || !isSpeechOn) {
                    stopSpeech(); // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒåœæ­¢ã¾ãŸã¯èª­ã¿ä¸Šã’OFFãªã‚‰åŒæœŸå‡¦ç†ã‚‚åœæ­¢
                    return;
                }

                // ãƒ†ã‚­ã‚¹ãƒˆè¦ç´ ãŒã¾ã å­˜åœ¨ã—ãªã„ã€ã¾ãŸã¯CSSã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒã¾ã é–‹å§‹ã•ã‚Œã¦ã„ãªã„å ´åˆ
                if (!tickerText || getComputedStyle(tickerText).animationPlayState === 'paused') {
                    animationFrameId = requestAnimationFrame(animateSpeech); // æ¬¡ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã§å†è©¦è¡Œ
                    return;
                }

                const currentTransform = getComputedStyle(tickerText).transform;
                // currentTransformãŒ'none'ã®å ´åˆã€ã¾ãŸã¯ã¾ã translateXãŒé©ç”¨ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
                if (currentTransform === 'none' || !currentTransform.includes('matrix(')) {
                     animationFrameId = requestAnimationFrame(animateSpeech);
                     return;
                }

                // translateXã®å€¤ã‚’å–å¾—
                const matrix = new DOMMatrixReadOnly(currentTransform);
                const currentX = matrix.m41; // translateXã®å€¤ (px)

                let accumulatedWidth = 0;
                for (let i = 0; i < speechQueue.length; i++) {
                    // å„éƒ¨åˆ†ãƒ†ã‚­ã‚¹ãƒˆã®å¹…ã‚’æ­£ç¢ºã«æ¸¬å®šã™ã‚‹ãŸã‚ã€ä¸€æ™‚çš„ã«spanè¦ç´ ã‚’ä½œæˆã—ã¦æ¸¬å®š
                    const tempSpan = document.createElement('span');
                    tempSpan.style.fontSize = tickerText.style.fontSize;
                    tempSpan.style.fontFamily = tickerText.style.fontFamily;
                    tempSpan.style.fontWeight = tickerText.style.fontWeight;
                    tempSpan.style.whiteSpace = 'nowrap';
                    tempSpan.style.position = 'absolute';
                    tempSpan.style.visibility = 'hidden';
                    tempSpan.textContent = speechQueue[i];
                    document.body.appendChild(tempSpan);
                    const partWidth = tempSpan.offsetWidth;
                    document.body.removeChild(tempSpan);

                    const textRightEdgeRelativeToStart = viewportRight + accumulatedWidth; // ãƒ†ã‚­ã‚¹ãƒˆã®å³ç«¯ãŒç”»é¢ã«ç¾ã‚Œã‚‹ä½ç½®ã®ç›®å®‰
                    
                    // ç¾åœ¨ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ã¨ãƒ†ã‚­ã‚¹ãƒˆã®å¹…ã‚’æ¯”è¼ƒã—ã€èª­ã¿ä¸Šã’ã‚’ãƒˆãƒªã‚¬ãƒ¼
                    // (tickerTextã®transformãŒãƒã‚¤ãƒŠã‚¹å€¤ã¨ã—ã¦å·¦ã«ç§»å‹•ã—ã¦ã„ã‚‹ãŸã‚ã€currentXã¯è² ã®å€¤)
                    if (currentX + textRightEdgeRelativeToStart <= viewportRight + (partWidth * 0.2) && i > lastSpokenIndex) { // ç”»é¢ã«å…¥ã£ã¦ãã¦ã€å°‘ã—è¦‹ãˆãŸã‚‰èª­ã¿ä¸Šã’é–‹å§‹ (èª¿æ•´å¯èƒ½)
                        if (i < speechQueue.length) { // ç¯„å›²ãƒã‚§ãƒƒã‚¯
                            speakCurrentText(speechQueue[i]);
                            lastSpokenIndex = i;
                        }
                    }
                    accumulatedWidth += partWidth;
                    // åŒºåˆ‡ã‚Šæ–‡å­—ã®å¹…ã‚‚è€ƒæ…®ã«å…¥ã‚Œã‚‹ï¼ˆç›®å®‰ï¼‰
                    if (speechQueue[i+1] && speechQueue[i+1].includes('â—‡')) {
                        accumulatedWidth += (tickerText.offsetWidth / currentText.length) * 2; // â—‡ã®å¹…ã‚’é©å½“ã«è¿½åŠ 
                    }
                }
                animationFrameId = requestAnimationFrame(animateSpeech);
            }

            // åˆå›ã®èª­ã¿ä¸Šã’é–‹å§‹
            if (speechQueue.length > 0) {
                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Œå…¨ã«ãƒªã‚»ãƒƒãƒˆã•ã‚ŒãŸå¾Œã«é–‹å§‹
                setTimeout(() => {
                    if (!isTickerPaused && isSpeechOn) {
                        animationFrameId = requestAnimationFrame(animateSpeech);
                    }
                }, 100); // å°‘ã—é…å»¶ã•ã›ã¦ã€ãƒ†ãƒ­ãƒƒãƒ—ãŒç”»é¢å¤–ã«å‡ºã‚‹ã®ã‚’å¾…ã¤
            }
        }

        /**
         * èª­ã¿ä¸Šã’ã‚’åœæ­¢ã™ã‚‹
         */
        function stopSpeech() {
            if (window.speechSynthesis) {
                window.speechSynthesis.cancel();
            }
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            }
            currentUtterance = null;
        }

        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---
        loadRssButton.addEventListener('click', async () => {
            stopRssUpdates();
            await fetchAndDisplayMultipleRss(true);
            startRssAutoUpdates();
        });

        stopRssButton.addEventListener('click', stopRssUpdates);

        tickerInput.addEventListener('input', (e) => {
            if (!isRssAutoUpdating) {
                currentText = e.target.value;
                updateTicker(true);
            } else {
                alert('RSSè‡ªå‹•æ›´æ–°ä¸­ã¯æ‰‹å‹•å…¥åŠ›ã§ãã¾ã›ã‚“ã€‚è‡ªå‹•æ›´æ–°ã‚’åœæ­¢ã—ã¦ãã ã•ã„ã€‚');
                e.target.value = currentText;
            }
        });

        speedInput.addEventListener('input', (e) => {
            currentSpeed = parseInt(e.target.value) || 0;
            updateTicker();
            saveSettings();
        });

        sizeSlider.addEventListener('input', (e) => {
            currentSize = parseInt(e.target.value);
            updateTicker();
            saveSettings();
        });

        fontSelect.addEventListener('change', (e) => {
            currentFont = e.target.value;
            updateTicker();
            saveSettings();
        });

        weightSlider.addEventListener('input', (e) => {
            currentWeight = parseInt(e.target.value);
            updateTicker();
            saveSettings();
        });

        textColorPicker.addEventListener('input', (e) => {
            currentTextColor = e.target.value;
            updateTicker();
            saveSettings();
        });

        bgColorPicker.addEventListener('input', (e) => {
            currentBgColor = e.target.value;
            tickerContainer.style.backgroundColor = currentBgColor;
            updateTicker();
            saveSettings();
        });

        speechRateSlider.addEventListener('input', (e) => {
            currentSpeechRate = parseFloat(e.target.value);
            if (currentUtterance) { // èª­ã¿ä¸Šã’ä¸­ã®å ´åˆã¯ã€é€Ÿåº¦ã‚’å³åº§ã«åæ˜ 
                currentUtterance.rate = currentSpeechRate;
            }
            saveSettings();
        });

        const STORAGE_KEY = 'teropTickerSettings';

        /**
         * ç¾åœ¨ã®è¨­å®šã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã™ã‚‹é–¢æ•°ã€‚
         */
        function saveSettings() {
            const settings = {
                speed: currentSpeed,
                size: currentSize,
                text: currentText,
                font: currentFont,
                weight: currentWeight,
                textColor: currentTextColor,
                bgColor: currentBgColor,
                rssUrl: rssUrlInput.value,
                controllerLeft: controller.style.left,
                controllerTop: controller.style.top,
                controllerWidth: controller.style.width,
                controllerHeight: controller.style.height,
                isControllerVisible: controllerVisible,
                isRssAutoUpdating: isRssAutoUpdating,
                speechRate: currentSpeechRate
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(settings));
        }

        /**
         * ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰è¨­å®šã‚’èª­ã¿è¾¼ã‚€é–¢æ•°ã€‚
         */
        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem(STORAGE_KEY));
            if (!settings) return;

            speedInput.value = settings.speed;
            sizeSlider.value = settings.size;
            tickerInput.value = settings.text;
            fontSelect.value = settings.font;
            weightSlider.value = settings.weight;
            textColorPicker.value = settings.textColor;
            bgColorPicker.value = settings.bgColor;
            rssUrlInput.value = settings.rssUrl;
            speechRateSlider.value = settings.speechRate !== undefined ? settings.speechRate : 1;

            currentSpeed = settings.speed;
            currentSize = settings.size;
            currentText = settings.text;
            currentFont = settings.font;
            currentWeight = settings.weight;
            currentTextColor = settings.textColor;
            currentBgColor = settings.bgColor;
            tickerContainer.style.backgroundColor = currentBgColor;
            currentSpeechRate = parseFloat(speechRateSlider.value);

            let savedLeft = parseFloat(settings.controllerLeft) || 20;
            let savedTop = parseFloat(settings.controllerTop) || 20;
            let savedWidth = parseFloat(settings.controllerWidth) || 400;
            let savedHeight = parseFloat(settings.controllerHeight) || 200;

            const minWidth = 250;
            const minHeight = 200;

            savedWidth = Math.max(savedWidth, minWidth);
            savedHeight = Math.max(savedHeight, minHeight);

            savedLeft = Math.max(0, Math.min(savedLeft, window.innerWidth - savedWidth - 20));
            savedTop = Math.max(0, Math.min(savedTop, window.innerHeight - savedHeight - 20));

            controller.style.left = `${savedLeft}px`;
            controller.style.top = `${savedTop}px`;
            controller.style.width = `${savedWidth}px`;
            controller.style.height = `${savedHeight}px`;

            updateControllerFontSize(savedWidth);

            controllerVisible = settings.isControllerVisible !== undefined ? settings.isControllerVisible : true;
            controller.style.display = controllerVisible ? 'block' : 'none';

            isRssAutoUpdating = settings.isRssAutoUpdating || false;

            updateTicker();
        }

        /**
         * è¨­å®šã‚’åˆæœŸå€¤ã«æˆ»ã™é–¢æ•°ã€‚
         */
        function resetSettings() {
            localStorage.removeItem(STORAGE_KEY);
            speedInput.value = 0;
            sizeSlider.value = 32;
            tickerInput.value = 'RSSãƒ•ã‚£ãƒ¼ãƒ‰ã‹ã‚‰èª­ã¿è¾¼ã¾ã‚ŒãŸæƒ…å ±ã€ã¾ãŸã¯æ‰‹å‹•ã§å…¥åŠ›ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚';
            fontSelect.value = 'sans-serif';
            weightSlider.value = 400;
            textColorPicker.value = '#222222';
            bgColorPicker.value = '#ffffff';
            rssUrlInput.value = '';
            speechRateSlider.value = 1;

            currentSpeed = 0;
            currentSize = 32;
            currentText = tickerInput.value;
            currentFont = 'sans-serif';
            currentWeight = 400;
            currentTextColor = '#222222';
            currentBgColor = '#ffffff';
            tickerContainer.style.backgroundColor = currentBgColor;
            currentSpeechRate = 1;

            controller.style.left = '20px';
            controller.style.top = '20px';
            controller.style.width = '400px';
            controller.style.height = 'auto';
            updateControllerFontSize(400);

            controllerVisible = true;
            controller.style.display = 'block';

            // ãƒ–ãƒ©ã‚¦ã‚¶ã‚¿ãƒ–ç”¨ã‚¢ã‚¤ã‚³ãƒ³ã‚’åˆæœŸçŠ¶æ…‹ã«æˆ»ã™
            document.getElementById('favicon').href = PAUSE_ICON_DATA_URL;

            stopRssUpdates();
            updateTicker(true);
            stopSpeech(); // åˆæœŸåŒ–æ™‚ã«èª­ã¿ä¸Šã’ã‚‚åœæ­¢
            alert('è¨­å®šã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸã€‚');
        }

        resetSettingsBtn.addEventListener('click', resetSettings);

        let controllerVisible = true;
        toggleControllerBtn.addEventListener('click', () => {
            controllerVisible = !controllerVisible;
            controller.style.display = controllerVisible ? 'block' : 'none';
            saveSettings();
        });

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«è¨­å®šèª­è¾¼ã¨RSSæ›´æ–°ã®ãƒã‚§ãƒƒã‚¯
        window.addEventListener('DOMContentLoaded', async () => {
            loadSettings();
            if (rssUrlInput.value.trim() && isRssAutoUpdating) {
                await fetchAndDisplayMultipleRss(true);
            } else {
                updateTicker(true);
            }
        });

        // --- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ãƒ‰ãƒ©ãƒƒã‚°ã¨ãƒªã‚µã‚¤ã‚º ---
        let isDragging = false;
        let isResizing = false;
        let offsetX = 0, offsetY = 0, startWidth = 0, startHeight = 0;
        const resizeHandleSize = 20;

        controller.addEventListener('mousedown', (e) => {
            const rect = controller.getBoundingClientRect();

            if (e.clientX > rect.right - resizeHandleSize && e.clientY > rect.bottom - resizeHandleSize) {
                isResizing = true;
                startWidth = rect.width;
                startHeight = rect.height;
                offsetX = e.clientX;
                offsetY = e.clientY;
                document.body.style.cursor = 'se-resize';
                return;
            }

            if (e.target.closest('#controller input, #controller label, #controller textarea, #controller button, #controller select, #controller h3, #controller p')) {
                return;
            }

            isDragging = true;
            controller.classList.add('dragging');
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
            document.body.style.cursor = 'move';
        });

        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                let newX = e.clientX - offsetX;
                let newY = e.clientY - offsetY;

                const maxX = window.innerWidth - controller.offsetWidth;
                const maxY = window.innerHeight - controller.offsetHeight;
                newX = Math.max(0, Math.min(newX, maxX));
                newY = Math.max(0, Math.min(newY, maxY));

                controller.style.left = `${newX}px`;
                controller.style.top = `${newY}px`;
            }
            if (isResizing) {
                let newWidth = startWidth + (e.clientX - offsetX);
                let newHeight = startHeight + (e.clientY - offsetY);

                const minWidth = 250;
                const minHeight = 200;

                newWidth = Math.max(newWidth, minWidth);
                newHeight = Math.max(newHeight, minHeight);

                newWidth = Math.min(newWidth, window.innerWidth - controller.offsetLeft - 10);
                newHeight = Math.min(newHeight, window.innerHeight - controller.offsetTop - 10);

                controller.style.width = `${newWidth}px`;
                controller.style.height = `${newHeight}px`;

                updateControllerFontSize(newWidth);
            }
        });

        document.addEventListener('mouseup', () => {
            if (isDragging || isResizing) {
                isDragging = false;
                isResizing = false;
                controller.classList.remove('dragging');
                document.body.style.cursor = '';
                saveSettings();
            }
        });

        controller.addEventListener('dragstart', (e) => {
            e.preventDefault();
        });

        zoomInBtn.addEventListener('click', () => {
            const currentWidth = parseInt(controller.style.width) || controller.offsetWidth;
            const currentHeight = parseInt(controller.style.height) || controller.offsetHeight;
            
            let newWidth = Math.min(currentWidth + 50, window.innerWidth - controller.offsetLeft - 10);
            let newHeight = Math.min(currentHeight + 30, window.innerHeight - controller.offsetTop - 10);

            controller.style.width = `${newWidth}px`;
            controller.style.height = `${newHeight}px`;
            updateControllerFontSize(newWidth);
            saveSettings();
        });

        zoomOutBtn.addEventListener('click', () => {
            const currentWidth = parseInt(controller.style.width) || controller.offsetWidth;
            const currentHeight = parseInt(controller.style.height) || controller.offsetHeight;
            
            let newWidth = Math.max(currentWidth - 50, 250);
            let newHeight = Math.max(currentHeight - 30, 200);

            controller.style.width = `${newWidth}px`;
            controller.style.height = `${newHeight}px`;
            updateControllerFontSize(newWidth);
            saveSettings();
        });

        speechOnBtn.addEventListener('click', () => {
            isSpeechOn = true;
            if (!isTickerPaused) {
                startSpeechSync(); // èª­ã¿ä¸Šã’é–‹å§‹
            }
        });

        speechOffBtn.addEventListener('click', () => {
            isSpeechOn = false;
            stopSpeech(); // èª­ã¿ä¸Šã’åœæ­¢
        });

        fontSizeUpBtn.addEventListener('click', () => {
            currentSize = Math.min(currentSize + 8, 120);
            sizeSlider.value = currentSize;
            updateTicker(true);
            saveSettings();
        });
        fontSizeDownBtn.addEventListener('click', () => {
            currentSize = Math.max(currentSize - 8, 12);
            sizeSlider.value = currentSize;
            updateTicker(true);
            saveSettings();
        });

        playBtn.addEventListener('click', () => {
            isTickerPaused = false;
            tickerText.style.animationPlayState = 'running';
            // ãƒ–ãƒ©ã‚¦ã‚¶ã‚¿ãƒ–ç”¨ã‚¢ã‚¤ã‚³ãƒ³ã‚’å¤‰æ›´
            document.getElementById('favicon').href = PLAY_ICON_DATA_URL;
            startSpeechSync(); // èª­ã¿ä¸Šã’å†é–‹
        });

        pauseBtn.addEventListener('click', () => {
            isTickerPaused = true;
            tickerText.style.animationPlayState = 'paused';
            // ãƒ–ãƒ©ã‚¦ã‚¶ã‚¿ãƒ–ç”¨ã‚¢ã‚¤ã‚³ãƒ³ã‚’å¤‰æ›´
            document.getElementById('favicon').href = PAUSE_ICON_DATA_URL;
            stopSpeech(); // èª­ã¿ä¸Šã’ä¸€æ™‚åœæ­¢
        });

        restartBtn.addEventListener('click', async () => {
            console.log("æœ€åˆã‹ã‚‰è¡¨ç¤ºãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¾ã—ãŸã€‚");
            isTickerPaused = false;
            // ãƒ–ãƒ©ã‚¦ã‚¶ã‚¿ãƒ–ç”¨ã‚¢ã‚¤ã‚³ãƒ³ã‚’å¤‰æ›´
            document.getElementById('favicon').href = PLAY_ICON_DATA_URL;
            stopSpeech(); // ç¾åœ¨ã®èª­ã¿ä¸Šã’ã¨åŒæœŸã‚’åœæ­¢

            if (isRssAutoUpdating && rssUrlInput.value.trim()) {
                await fetchAndDisplayMultipleRss(false, true);
            } else {
                updateTicker(true); // trueã‚’æ¸¡ã—ã¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆ
            }
            console.log("ãƒ†ãƒ­ãƒƒãƒ—ãŒæœ€åˆã‹ã‚‰å†é–‹ã•ã‚Œã¾ã—ãŸã€‚");
        });

        manualBtn.addEventListener('click', () => {
            manualModal.style.display = 'flex';
        });

        closeButton.addEventListener('click', () => {
            manualModal.style.display = 'none';
        });

        window.addEventListener('click', (e) => {
            if (e.target === manualModal) {
                manualModal.style.display = 'none';
            }
        });

        // Service Workerã®ç™»éŒ²
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>
</body>
</html>
